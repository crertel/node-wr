<!DOCTYPE html>
<html>
  <head>
    <title>Water Rower</title>
    <meta charset="utf-8" />
  </head>
  <body>
    <h1> Water Rower </h1>
    <button id="reset_button"> Reset </button>
    <div>
      <span id="keypad"> </span>

      <p id="strokesPerMinute">
        <span id="-strokesPerMinute"></span> <br>
        Strokes per minute
      </p>
      <p id="elapsedTime">
        <span id="-elapsedTime"></span> <br>
        Elapsed time
      </p>
      <p id="totalDistance">
        <span id="-totalDistance"></span> <br>
        Total distance
      </p>
    </div>

    <script>
      var ws = new WebSocket("ws://" + location.host);
      var $keypad = document.getElementById("keypad");
      var $resetButton = document.getElementById("reset_button");

      var $dispStrokesPerMinute = document.getElementById('-strokesPerMinute');
      var $dispElapsedTime = document.getElementById('-elapsedTime');
      var $dispTotalDistance = document.getElementById('-totalDistance');

      $resetButton.onclick = function postReset() {
        var msg = { msg: "reset rower"};
        ws.send( JSON.stringify(msg) );
      };

      ws.onmessage = function(rawMsg) {
        var msg = JSON.parse(rawMsg.data);

        if (msg.type === 'readings') {
          $dispElapsedTime.innerHTML = (msg.data.displayTimeHours > 9) ? msg.data.displayTimeHours : ("0"+msg.data.displayTimeHours) + ":"
                                       + (msg.data.displayTimeMinutes > 9) ? msg.data.displayTimeMinutes : ("0"+msg.data.displayTimeMinutes) + ":"
                                       + (msg.data.displayTimeSeconds > 9) ? msg.data.displayTimeSeconds : ("0"+msg.data.displayTimeSeconds);

          $dispTotalDistance.innerHTML = msg.data.distance;
          $dispStrokesPerMinute.innerHTML = msg.data.strokesPerMinute;

        } else if (msg.type ==='keypad') {
          $keypad.innerHTML = 'Button: ' + msg.data;
        }
      }

      /*
      Readings may be:
      this.readings = {
        strokesPerMinute: 0,  // "stroke_pull is first subtracted from stroke_average then a modifier of 1.25 multipled by the result to generate the ratio value for display"
        strokeCount: 0,       // number
        totalSpeed: 0,        // cm/s
        averageSpeed: 0,      // cm/s
        distance: 0,          // m
        heartRate: 0,         // bpm
        displayTimeSeconds: 0,
        displayTimeMinutes: 0,
        displayTimeHours: 0
      };
      */
    </script>
  </body>
</html>
