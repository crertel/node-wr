<!DOCTYPE html>
<html>
  <head>
    <title>Water Rower</title>
    <meta charset="utf-8" />
    <script src="js/channel.js"></script>

    <style>
      #viewport {
        background-color: #222;
        position: absolute;
        width: 100%;
        height: 100%;
        z-index: 0;
        padding:0px;
        margin:0px;
      }

      #strokesPerMinute {
        position: absolute;
        left: 50%;
        bottom: 0px;
        background-color: blue;
        z-index: 55;
      }

      #elapsedTime {
        position: absolute;
        left: 0px;
        bottom: 0px;
        background-color: green;
        z-index: 55;
      }

      #totalDistance {
        position: absolute;
        right: 0px;
        bottom: 0px;
        background-color: yellow;
        z-index: 55;
      }

      #reset_button {
        position: absolute;
        right: 50%;
        top: 0px;
        z-index: 55;
      }

      .hud-number{
        font-size: 2em;
      }

      .hud-label{
        text-align: center;
        width: 200px;
        border: solid 10px rgba(0, 0, 0, 0.5);
      }

      body, html {
        height: 100%;
        width:100%;
        padding:0px;
        margin:0px;
      }
    </style>
  </head>
  <body>
    <div>
      <button id="reset_button"> Reset </button>

      <p id="strokesPerMinute" class="hud-label">
        <span id="-strokesPerMinute" class="hud-number">???</span> <br>
        Strokes per minute
      </p>
      <p id="elapsedTime" class="hud-label">
        <span id="-elapsedTime" class="hud-number">???</span> <br>
        Elapsed time
      </p>
      <p id="totalDistance" class="hud-label">
        <span id="-totalDistance" class="hud-number">???</span> <br>
        Total distance
      </p>
      <canvas id="viewport" width="600" height="400">
      </canvas>
    </div>

    <script>
      var ws = new WebSocket("ws://" + location.host);
      var $resetButton = document.getElementById("reset_button");

      var $dispStrokesPerMinute = document.getElementById('-strokesPerMinute');
      var $dispElapsedTime = document.getElementById('-elapsedTime');
      var $dispTotalDistance = document.getElementById('-totalDistance');

      $resetButton.onclick = function postReset() {
        var msg = { msg: "reset rower"};
        ws.send( JSON.stringify(msg) );
      };

      ws.onmessage = function(rawMsg) {
        var msg = JSON.parse(rawMsg.data);

        if (msg.type === 'readings') {
          $dispElapsedTime.innerHTML = (msg.data.displayTimeHours > 9) ? msg.data.displayTimeHours : ("0"+msg.data.displayTimeHours) + ":"
                                       + (msg.data.displayTimeMinutes > 9) ? msg.data.displayTimeMinutes : ("0"+msg.data.displayTimeMinutes) + ":"
                                       + (msg.data.displayTimeSeconds > 9) ? msg.data.displayTimeSeconds : ("0"+msg.data.displayTimeSeconds);

          $dispTotalDistance.innerHTML = msg.data.distance;
          $dispStrokesPerMinute.innerHTML = msg.data.strokesPerMinute;

        }
      }

      /*
      Readings may be:
      this.readings = {
        strokesPerMinute: 0,  // "stroke_pull is first subtracted from stroke_average then a modifier of 1.25 multipled by the result to generate the ratio value for display"
        strokeCount: 0,       // number
        totalSpeed: 0,        // cm/s
        averageSpeed: 0,      // cm/s
        distance: 0,          // m
        heartRate: 0,         // bpm
        displayTimeSeconds: 0,
        displayTimeMinutes: 0,
        displayTimeHours: 0
      };
      */
    </script>
  </body>
</html>
